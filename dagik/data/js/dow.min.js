var DOW={};function force_bool(e){return 1===e}DOW.VERSION="2.0.2-20190303","object"==typeof module&&(module.exports=DOW),DOW.WTOP=2,DOW.CKK_STD_FPS=5,DOW.CKK_EARTHXY_POLICY=!0,DOW.CKK_ROTATION_POLICY=!1,DOW.MESSAGES_JA={M0001:'ロード中(loading)<p><button onclick="window.history.back();">戻る(back)</button><button onclick="window.location.reload( false );">リロード(reload)</button></p>',M0002:'ロード中(loading)<p><button onclick="window.history.back();">戻る(back)</button><button onclick="window.location.reload( false );">リロード(reload)</button></p>',M1001:'エラーが発生しました(Errors)<p><button onclick="window.history.back();">戻る(back)</button><button onclick="window.location.reload( false );">リロード(reload)</button></p>',M1002:'画像の更新失敗(Update error)<p><button onclick="dow.console.clear();">OK</button></p>',E0001:"ブラウザがDagikEarthに対応していません(WebGL)",E0011:"設定ファイルがありません",E0012:"設定ファイルが読み込めません",E0013:"未定義のパラメータです",E0014:"パラメータの数が足りません",E0015:"パラメータは数値でなければなりません",E0016:"パラメータが不正な値です",E0018:"Web版では正しい(9999以外の)TextureEndを明示してください",E0019:"設定ファイルの処理中にエラーが起きました",E0101:"画像を読み込めません",W0101:"画像を読み込めません",I0101:"画像を読み込めません",E0102:"書式に誤りがあります",I0103:"自動で再読込します",I9999:"参考"},DOW.BUTTON_ALT_TEXT_JA={IconScaleXY:"Play",Icon2ScaleXY:"Reset",Icon3ScaleXY:"Reverse",Icon4ScaleXY:"Spin on off",Icon5ScaleXY:"Step forward",Icon6ScaleXY:"Step backward",Icon7ScaleXY:"Grid on off",Icon8ScaleXY:"Zoom up",Icon9ScaleXY:"Zoom down",Icon10ScaleXY:"North up",Icon11ScaleXY:"Faster",Icon12ScaleXY:"Slower",Icon13ScaleXY:"Back",Icon14ScaleXY:"Fullscreen",Icon15ScaleXY:"",Icon16ScaleXY:"",Icon17ScaleXY:"",Icon18ScaleXY:"",Icon19ScaleXY:"",Icon20ScaleXY:"",Icon21ScaleXY:"Switch layer",Icon22ScaleXY:"Screen on off",Icon23ScaleXY:"Icons on off",Icon24ScaleXY:"",Icon25ScaleXY:"",Icon26ScaleXY:"",Icon27ScaleXY:""},DOW.MESSAGES=DOW.MESSAGES_JA,DOW.BUTTON_ALT_TEXT=DOW.BUTTON_ALT_TEXT_JA,DOW.IGNORE_ERRORS=["E0011","E0012","E0013"],DOW.ICONS=[["IconScaleXY","forward_play","forward_play","play.png","pause.png"],["Icon2ScaleXY","initialize","initialize","initial.png"],["Icon3ScaleXY","reverse_play","reverse_play","r_play.png","pause.png"],["Icon4ScaleXY","auto_spin","auto_spin","spin.png","stop_spin.png"],["Icon5ScaleXY","step_forward","step_forward_or_wrap","forward.png"],["Icon6ScaleXY","step_backward","step_backward_or_wrap","back.png"],["Icon7ScaleXY","show_grid","show_grid","line.png","delete_line.png"],["Icon8ScaleXY","zoom_in","zoom_in","zoomin.png"],["Icon9ScaleXY","zoom_out","zoom_out","zoomout.png"],["Icon10ScaleXY","reset_north","reset_north","north.png"],["Icon11ScaleXY","play_fast","play_fast","fast.png"],["Icon12ScaleXY","play_slow","play_slow","slow.png"],["Icon13ScaleXY","quit","quit","quit.png"],["Icon14ScaleXY","fullscreen","fullscreen","normalscreen.png","fullscreen.png"],["Icon15ScaleXY","screen_small","screen_small","logo_small.png"],["Icon16ScaleXY","screen_large","screen_large","logo_large.png"],["Icon17ScaleXY","screen_left","screen_left","logo_left.png"],["Icon18ScaleXY","screen_right","screen_right","logo_right.png"],["Icon19ScaleXY","screen_down","screen_down","logo_down.png"],["Icon20ScaleXY","screen_up","screen_up","logo_up.png"],["Icon21ScaleXY","layer","layer","layer1.png","layer2.png"],["Icon22ScaleXY","show_screen","show_screen","screen_on.png","screen_off.png"],["Icon23ScaleXY","hide_all_icons","hide_all_icons","icon_on.png","icon_off.png"],["Icon24ScaleXY","draring_pen","draring_pen","drawing_off.png","drawing_on.png"],["Icon25ScaleXY","drawing_erase","drawing_erase","drawing_erase.png"],["Icon26ScaleXY","drawing_save","drawing_save","drawing_save.png"],["Icon27ScaleXY","forward_changelayer","forward_changelayer","forward-changelayer.png"]],DOW.KEY_ACTION={ESCAPE:"fullscreen_off",UP_ARROW:"up_arrow_key",DOWN_ARROW:"down_arrow_key",LEFT_ARROW:"left_arrow_key",RIGHT_ARROW:"right_arrow_key",q:"quit",Q:"quit",a:"step_forward",w:"forward_changelayer",A:"step_forward10",c:"show_screen",o:"layer",b:"step_backward",B:"step_backward10",r:"reverse_play",L:"zoom_in",l:"zoom_in_petit",H:"zoom_out",h:"zoom_out_petit",s:"auto_spin",m:"show_grid",f:"fullscreen",i:"initialize_view, first_frame",j:"initialize_view",I:"first_frame",J:"last_frame",n:"reset_north",C:"hide_all_icons"," ":"pause_or_play","+":"play_fast","-":"play_slow",">":"spin_fast","<":"spin_slow",1:"screen_small",2:"screen_large",3:"screen_left",4:"screen_right",5:"screen_down",6:"screen_up",D:"toggle_console",F:"loading_console",R:"force_reload"},DOW.log=function(e){console.log(e)},DOW.Plugins={},DOW.RegisterPlugin=function(e){DOW.Plugins.hasOwnProperty(e.name)?console.warn("Plugin "+e.name+" has been installed. (name confliction)"):DOW.Plugins[e.name]=e},DOW.plugins=function(){const e=[1];var t=[],n={on_gl_ready:{point:"post",handlers:[]},on_pre_config:{point:"pre",handlers:[]},on_post_config:{point:"post",handlers:[]},on_pre_load:{point:"pre",handlers:[]},on_post_load:{point:"post",handlers:[]},on_pre_scene:{point:"pre",handlers:[]},on_post_scene:{point:"post",handlers:[]},on_pre_frame:{point:"pre",handlers:[]},on_post_frame:{point:"post",handlers:[]},on_pre_render:{point:"pre",handlers:[]},on_post_render:{point:"post",handlers:[]},on_pre_stop:{point:"pre",handlers:[]},on_post_stop:{point:"post",handlers:[]}};return{register:function(n){var i=n.plugins;for(var o in i&&(i.default=i.default||"enable",i.enable=i.enable||[],i.disable=i.disable||[]),DOW.Plugins){if(i)if("enable"==i.default){if(-1!==i.disable.indexOf(o))continue}else if(-1===i.enable.indexOf(o))continue;var a=DOW.Plugins[o];-1!==e.indexOf(a.api_version)?(DOW.log("Registering plugin: "+a.name+" (version "+a.version+" by "+a.vender+")"),t.push(a)):console.warn("Can not register plugin '"+a.name+"' (invalid api version: "+a.api_version+")")}},init:function(e,i){t.forEach(function(t){for(var o in t.init_params&&t.init_params(e&&e.hasOwnProperty(t.name)?e[t.name]:void 0),t.init&&t.init(i),n)t.hasOwnProperty(o)&&("pre"==n[o].point?n[o].handlers.unshift(t[o]):n[o].handlers.push(t[o]))})},run:function(e,n){t.forEach(function(t){t.run_params&&t.run_params(e&&e.hasOwnProperty(t.name)?e[t.name]:void 0),t.run&&t.run(n)})},invoke:function(e,t){n.hasOwnProperty(e)&&n[e].handlers.forEach(function(e){e(t)})}}}(),DOW.Console=function(e,t){this.type="Console",this.domElement=document.createElement("div"),this.domElement.id="dow_console",t.appendChild(this.domElement),this.domElement.innerHTML="<div class='progress'><canvas width='40px' height='40px'></canvas><div class='message'></div></div><div class='error'></div><div class='details'></div>",this.progressElement=this.domElement.childNodes[0],this.spinner=this.progressElement.childNodes[0],this.progressMessage=this.progressElement.childNodes[1],this.errorElement=this.domElement.childNodes[1],this.detailsElement=this.domElement.childNodes[2],this.hasError=!1,this.phase=0,this.progressing=!0;var n=this;window.setInterval(function(){n.update_spinner()},100)},DOW.Console.prototype={show:function(){this.domElement.style.display="block"},hide:function(){this.domElement.style.display="none"},toggle:function(){this.domElement.style.display="none"==this.domElement.style.display?"block":"none"},showProgress:function(e,t,n,i){this.hideError(),this.progressElement.style.display="block",this.progressMessage.innerHTML=t+" / "+n+"<br>"+i,this.show()},hideProgress:function(){this.progressMessage.innerHTML="",this.progressElement.style.display="none"},showError:function(e){this.hideProgress(),this.errorElement.style.display="block",this.errorElement.innerHTML=e,this.show()},hideError:function(){this.errorElement.innerHTML="",this.errorElement.style.display="none"},addDetail:function(e,t){var n=e.charAt(0);"E"==n&&(DOW.IGNORE_ERRORS.indexOf(e)<0?this.hasError=!0:n="W"),this.detailsElement.style.display="block",this.detailsElement.innerHTML+="<li class=detail_"+n+">"+DOW.MESSAGES[e]+": "+t+"</li>\n"},clearDetails:function(){this.detailsElement.style.display="none",this.detailsElement.innerHTML=""},clear:function(){this.hasError=!1,this.hideProgress(),this.hideError(),this.clearDetails(),this.hide()},update_spinner:function(){if("none"!=this.domElement.style.display&&"none"!=this.progressElement.style.display){var e=this.spinner.height,t=2*Math.PI;for(this.phase+=.5*t*.1;this.phase>t;)this.phase-=t;var n=this.spinner.getContext("2d");n.clearRect(0,0,e,e),n.strokeStyle="rgba(255, 255, 255, 0.8)",n.lineWidth=5,n.beginPath(),this.progressing?(n.arc(e/2,e/2,e/3,this.phase,this.phase+Math.PI,!0),n.stroke(),n.beginPath(),n.arc(e/2,e/2,e/3,2*-this.phase,2*-this.phase+Math.PI,!1),n.lineWidth=1):n.arc(e/2,e/2,e/3,0,t,!0),n.stroke()}}},DOW.Config=function(e){this.type="Config",this.pre_loading_hook=void 0,this.post_loading_hook=void 0,this.app=e,this.loader=this._loader},DOW.Config.PARAMETER_DEFINITION={WindowSizeXY:[[800,600]],WindowPositionXY:[[0,0]],FullScreen:[0,force_bool],Perspective:[0,force_bool],EyePosition:[20],Animation:[0,function(e){return 1!=e&&-1!=e?0:e}],AnimationSpeed:[8],StopAt1stMap:[.2],StopAtFinalMap:[0],Repeat:[0,force_bool],Spin:[0,force_bool],SpinSpeed:[6],EarthXY:[[0,0]],Scale:[1],Latitude:[0],Longitude:[0],ScreenOn:[1,force_bool],ScreenScaleXY:[[3,-2.5,1]],ScreenFront:[0,force_bool],TimebarScaleXY:[[1,-1,-1]],TextureName:[""],TextureSuffix:[""],ScreenName:[""],ScreenSuffix:[""],SecondTextureName:[""],SecondTextureSuffix:[""],SecondScreenName:[""],SecondScreenSuffix:[""],TextureStart:[0],TextureEnd:[9999],SecondTexture_at_startup:[0,force_bool],AltTextureName:[["",""]],AltScreenName:[["",""]],AltSecondTextureName:[["",""]],AltSecondScreenName:[["",""]],NumberOfEarth:[1,function(e){return 2!=e?1:2}],WindowSizeXY2:[[-9999,-9999]],WindowPositionXY2:[[-9999,-9999]],FullScreen2:[0],Earth2XY:[[0,0]],Latitude2:[0],Longitude2:[0],Scale2:[1],ScreenScaleXY2:[[3,-2.5,1]],TextureOfEarth2:[0,force_bool],EarthRotationSynch:[1,force_bool],EarthSizeSynch:[1,force_bool],Earth2AngleAxisXY:[[0,0,1]],NumberOfTextures:[1,function(e){return 2!=e?1:2}],TextureName2:[""],TextureSuffix2:[""],ScreenName2:[""],ScreenSuffix2:[""],SecondTextureName2:[""],SecondTextureSuffix2:[""],SecondScreenName2:[""],SecondScreenSuffix2:[""],AltTextureName2:[["",""]],AltScreenName2:[["",""]],AltSecondTextureName2:[["",""]],AltSecondScreenName2:[["",""]],InvisibleCursor:[0,force_bool],NoMouseDragRotation:[0,force_bool],ClickLock:[0,force_bool],Icon:[0],IconScaleXY:[[0,NaN,NaN]],Icon2ScaleXY:[[0,NaN,NaN]],Icon3ScaleXY:[[0,NaN,NaN]],Icon4ScaleXY:[[0,NaN,NaN]],Icon5ScaleXY:[[0,NaN,NaN]],Icon6ScaleXY:[[0,NaN,NaN]],Icon7ScaleXY:[[0,NaN,NaN]],Icon8ScaleXY:[[0,NaN,NaN]],Icon9ScaleXY:[[0,NaN,NaN]],Icon10ScaleXY:[[0,NaN,NaN]],Icon11ScaleXY:[[0,NaN,NaN]],Icon12ScaleXY:[[0,NaN,NaN]],Icon13ScaleXY:[[0,NaN,NaN]],Icon14ScaleXY:[[0,NaN,NaN]],Icon15ScaleXY:[[0,NaN,NaN]],Icon16ScaleXY:[[0,NaN,NaN]],Icon17ScaleXY:[[0,NaN,NaN]],Icon18ScaleXY:[[0,NaN,NaN]],Icon19ScaleXY:[[0,NaN,NaN]],Icon20ScaleXY:[[0,NaN,NaN]],Icon21ScaleXY:[[0,NaN,NaN]],Icon22ScaleXY:[[0,NaN,NaN]],Icon23ScaleXY:[[0,NaN,NaN]],Icon24ScaleXY:[[0,NaN,NaN]],Icon25ScaleXY:[[0,NaN,NaN]],Icon26ScaleXY:[[0,NaN,NaN]],Icon27ScaleXY:[[0,NaN,NaN]],PresentationRemoteMode:[0,force_bool],PresentaionRemoteMode:[0,force_bool],MeridianLatitude:[[0,12,6,3,5],function(e){return e[0]=force_bool(e[0]),e}],ColorMeridianLatitude:[[1,1,1,1,.8,.2,.2,1]],SpinIntervalSecond:[1e-4],InertiaOfRotation:[[.1,.01,.04,.995]],LineThicknessColor:[[5,1,1,1,1]],PaletteScaleXY:[[.15,-2.5,1.2]],ArrowsName:[""],ArrowsSuffix:[""],ArrowsOn:[[1]],ArrowsInitDisplay:[[1]],LinesName:[""],LinesSuffix:[""],LinesOn:[[1]],LinesInitDisplay:[[1]],PointsName:[""],PointsSuffix:[""],PointsOn:[[1]],PointsInitDisplay:[[1]],WindowTitle:[""],WindowTitle2:[""],ScreenBGTransparency:[""],AutoReload:[0],AutoReloadIntervalMin:[0]},DOW.Config.prototype={init:function(){for(var e in this.has_error=!1,DOW.Config.PARAMETER_DEFINITION)this[e]=DOW.Config.PARAMETER_DEFINITION[e][0]},set_loader_wrapper:function(e){this.loader=void 0!==e?e(this._loader):this._loader},load:function(e,t,n){this.init(),void 0!==this.pre_loading_hook&&this.pre_loading_hook(this);var i=this;this._load_one(e,function(){void 0!==i.post_loading_hook&&i.post_loading_hook(i),t()},t,n)},_loader:{load:function(e,t,n,i){var o=new XMLHttpRequest;o.onreadystatechange=function(){o.readyState===o.DONE&&(200!==o.status&&0!==o.status?i(["E0011",e+" (error state:"+o.status+")"]):null==o.responseText||0==o.responseText.length?i(["E0012",e+" (Could not read)"]):t(o.responseText))},o.open("GET",e,!0),o.setRequestHeader("Pragma","no-cache"),o.setRequestHeader("Cache-Control","no-cache"),o.send(null)}},_load_one:function(e,t,n){var i=this;if(e.length>0){var o=e[0];n&&Date.now();this.loader.load(o,function(a){var r=a.split(/[\n\r]+/);for(var s in r)if("#"==r[s][0]){var l=r[s].split(/\s+/),c=l[0].slice(1),h=DOW.Config.PARAMETER_DEFINITION[c];if(void 0!=h)if(Array.isArray(h[0])&&l.length<h[0].length+1)i.app.console.addDetail("E0014",r[s]+" (line "+s+" in "+o+")"),i.app.console.hasError&&(i.has_error=!0);else if(!Array.isArray(h[0])&&l.length<2)i.app.console.addDetail("E0014",r[s]+" (line "+s+" in "+o+")"),i.app.console.hasError&&(i.has_error=!0);else{var _=Array.isArray(h[0])?l.slice(1,h[0].length+1):l[1],u=l.slice(0,Array.isArray(h[0])?h[0].length+1:2).join(" ");if(Array.isArray(_))for(var d in h[0])"number"==typeof h[0][d]&&(_[d]=parseFloat(_[d]),isNaN(_[d]))&&(i.app.console.addDetail("E0015",u+" (line "+s+" of "+o+")"),i.app.console.hasError&&(i.has_error=!0));else if("number"==typeof h[0]&&(_=parseFloat(_),isNaN(_))){i.app.console.addDetail("E0015",u+" (line "+s+" of "+o+")"),i.app.console.hasError&&(i.has_error=!0);continue}if(h.length>1)try{_=h[1](_)}catch(e){i.app.console.addDetail("E0019",u+" (line "+s+" of "+o+")"),i.app.console.hasError&&(i.has_error=!0);continue}i[c]=_}else i.app.console.hasError&&(i.has_error=!0)}i._load_one(e.slice(1),t,n)},void 0,function(o){"array"==typeof o?i.app.console.addDetail(o[0],o[1]):i.app.console.addDetail("E0012",o),i.app.console.hasError&&(i.has_error=!0),i._load_one(e.slice(1),t,n)})}else i.has_error?i.app.console.showError(DOW.MESSAGES.M1001):t()},debug_log:function(){for(var e in DOW.Config.PARAMETER_DEFINITION)DOW.log(e+": "+this[e])}},DOW.CompressedTextureUtil={Formats:[],checkExtensions:function(e){var t;null!==(t=e.extensions.get("WEBGL_compressed_texture_s3tc"))&&DOW.CompressedTextureUtil.Formats.push({gl:t.COMPRESSED_RGB_S3TC_DXT1_EXT,name:"RGB_S3TC_DXT1",three:THREE.RGB_S3TC_DXT1_Format},{gl:t.COMPRESSED_RGBA_S3TC_DXT1_EXT,name:"RGBA_S3TC_DXT1",three:THREE.RGBA_S3TC_DXT1_Format},{gl:t.COMPRESSED_RGBA_S3TC_DXT3_EXT,name:"RGBA_S3TC_DXT3",three:THREE.RGBA_S3TC_DXT3_Format},{gl:t.COMPRESSED_RGBA_S3TC_DXT5_EXT,name:"RGBA_S3TC_DXT5",three:THREE.RGBA_S3TC_DXT5_Format}),null!==(t=e.extensions.get("WEBGL_compressed_texture_pvrtc"))&&DOW.CompressedTextureUtil.Formats.push({gl:t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG,name:"RGB_PVRTC_4BPPV1",three:THREE.RGB_PVRTC_4BPPV1_Format},{gl:t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG,name:"RGB_PVRTC_2BPPV1",three:THREE.RGB_PVRTC_2BPPV1_Format},{gl:t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG,name:"RGBA_PVRTC_4BPPV1",three:THREE.RGBA_PVRTC_4BPPV1_Format},{gl:t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG,name:"RGBA_PVRTC_2BPPV1",three:THREE.RGBA_PVRTC_2BPPV1_Format}),null!==(t=e.extensions.get("WEBGL_compressed_texture_etc1"))&&DOW.CompressedTextureUtil.Formats.push({gl:t.COMPRESSED_RGB_ETC1_WEBGL,name:"RGB_ETC1",three:THREE.RGB_ETC1_Format})},parseKTXFile:function(e,t){var n,i={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},o=new Uint8Array(e),a=new Uint32Array(e);if(n=o,![171,75,84,88,32,49,49,187,13,10,26,10].every(function(e,t){return e==n[t]}))return i.error="KTXファイルではありません",i;var r=67305985!=a[3]?function(e){return o[e*=4]+(o[e+1]<<8)+(o[e+1]<<16)+(o[e+1]<<24)}:function(e){return a[e]},s=r(4),l=r(5),c=r(6),h=r(7),_=(r(8),r(9)),u=r(10),d=r(11),m=r(12),p=r(13),f=r(14),g=r(15);if(0==f&&(f=1),0!=s||1!=l||0!=c)return i.error="KTXLoaderは圧縮テクスチャー専用です",i;if(0!=d)return i.error="KTXLoaderは3Dテクスチャーに非対応です",i;if(0!=m)return i.error="KTXLoaderはテクスチャーアレイに非対応です",i;if(1!=p)return i.error="KTXLoaderはキューブマップに非対応です",i;var y=DOW.CompressedTextureUtil.Formats.find(function(e){return e.gl==h});if(void 0===y)return i.error="圧縮フォーマットが非対応です:"+h,i;for(var E=64+g,w=_,S=u,v=0;v<f;v++){var O=r(E/4),T={data:new Uint8Array(e,E+4,O),width:w,height:S};if(i.mipmaps.push(T),w=Math.max(w>>1,1),S=Math.max(S>>1,1),E+=4+O+(3-(O+3)%4),!t)break}return i.width=_,i.height=u,i.mipmapCount=i.mipmaps.length,i.format=y.three,i}},DOW.KTXLoaderWithoutTexture=function(e,t){this.manager=void 0!==t?t:THREE.DefaultLoadingManager,this.no_mipmap=1==e},DOW.KTXLoaderWithoutTexture.prototype={constructor:DOW.KTXLoaderWithoutTexture,load:function(e,t,n,i){var o=new THREE.FileLoader(this.manager);o.setResponseType("arraybuffer");var a={};return o.load(e,function(e){var n=DOW.CompressedTextureUtil.parseKTXFile(e,!this.no_mipmap);n.error?i(n.error):(Object.assign(a,n),t&&t(a))},n,i),a}},DOW.KTXLoader=function(e){this._parser=function(t,n){return DOW.CompressedTextureUtil.parseKTXFile(t,n&&1!=e)}},DOW.KTXLoader.prototype=Object.create(THREE.CompressedTextureLoader.prototype),DOW.KTXLoader.prototype.constructor=DOW.KTXLoader,DOW.AnimationController=function(){this.type="AnimationController",this.loop=!1,this.firstFramePause=0,this.lastFramePause=0,this._syncMaster=new DOW.AnimatorSyncMaster,this._player_state="STOPED"},DOW.AnimationController.prototype={get status(){return"STOPED"==this._player_state?0:this._syncMaster.speed>0?1:-1},get speed(){return this._syncMaster.speed},set speed(e){this._syncMaster.speed=e},get frame(){return this._syncMaster.frame},get numberOfFrames(){return this._syncMaster.numberOfFrames},add:function(e){Array.isArray(e)?e.forEach(function(e,t,n){this._syncMaster.add_animator(e)},this):this._syncMaster.add_animator(anim)},play:function(){"STOPED"==this._player_state&&(this._player_state="START_PLAY")},pause:function(){"STOPED"!=this._player_state&&(this._syncMaster.pause(),this._player_state="STOPED")},seek:function(e){this._syncMaster.seek(e)},step:function(e){var t=this._syncMaster.frame;this._syncMaster.frame=t+e},update:function(e){this._player_state,"START_PLAY"===this._player_state&&(this._speed>0&&1==this._syncMaster.currentPosition&&this._syncMaster.seek(0),this._speed<0&&0==this._syncMaster.currentPosition&&this._syncMaster.seek(this._syncMaster.numberOfFrames),this._syncMaster.play(),this._player_state="PLAYING"),"PLAYING"===this._player_state&&(this._syncMaster.update(e),this._syncMaster.playing||(this.loop?(this._pause_timer=this._syncMaster.speed>0?this.lastFramePause:this.firstFramePause,this._player_state="POST_PAUSE"):(this._syncMaster.pause(),this._player_state="STOPED"))),"POST_PAUSE"===this._player_state&&(this._pause_timer>0?this._pause_timer-=e:(this._syncMaster.seek(this._syncMaster.speed>0?0:this._syncMaster.numberOfFrames),this._syncMaster.update(e),this._pause_timer=this._syncMaster.speed>0?this.firstFramePause:this.lastFramePause,this._player_state="PRE_PAUSE")),"PRE_PAUSE"===this._player_state&&(this._pause_timer>0?this._pause_timer-=e:(this._syncMaster.play(),this._player_state="PLAYING"))}},DOW.TextureAnimator=function(e){switch(this.type="TextureAnimator",this.layer=e,this._time=0,this._current_frame=0,e.resource_type){case"image":this._texture=new THREE.Texture(e.resources[0]),this._texture.needsUpdate=!0,DOW.log("image: "+e.resources[0]);break;case"texdata":var t=e.resources[0];this._texture=new THREE.CompressedTexture(t.mipmaps,t.width,t.height,t.format),1==t.mipmaps.length&&(this._texture.minFilter=THREE.LinearFilter),0==(t.width&t.width-1)&&0==(t.width&t.width-1)||(this._texture.minFilter=THREE.LinearFilter),this._texture.needsUpdate=!0,DOW.log("texData: "+e.resources[0])}this._playing=!1,this._enable=!1},DOW.TextureAnimator.prototype={constructor:DOW.TextureAnimator,get isImages(){return"image"==this.layer.resource_type},get isTexData(){return"texdata"==this.layer.resource_type},get length(){return this.layer.length},get duration(){return this.layer.length/DOW.CKK_STD_FPS},get texture(){return this._texture},get aspect(){return this.texture.image.width/this.texture.image.height},get enable(){return this._enable},set enable(e){e&&!this._enable&&this._update_frame(),this._enable=e},setTargetMaterial:function(e){this._material=e},seek:function(e){var t=Math.floor(e);t<0&&(t=0),t>this.layer.length-1&&(t=this.layer.length-1),this._current_frame!=t&&(this._current_frame=t,this._enable&&this._update_frame())},_update_frame:function(){if(this.isImages){var e=this.layer.resources[this._current_frame];e&&e.width>0&&(this._texture.image=e,this._texture.needsUpdate=!0)}else if(this.isTexData){var t=this.layer.resources[this._current_frame];t&&t.mipmaps&&(this._texture.mipmaps=t.mipmaps,this._texture.image.width=t.width,this._texture.image.height=t.height,this._texture.format=t.format,this._texture.needsUpdate=!0)}this._material instanceof THREE.MeshBasicMaterial?this._material.map=this._texture:this._material instanceof THREE.ShaderMaterial&&this._material.uniforms.map.value!=this._texture&&(this._material.uniforms.map.value=this._texture)}},DOW.AnimatorSyncMaster=function(){this.type="AnimatorSyncMaster",this.sequences=[],this._frame=0,this._speed=1,this._playing=!1},DOW.AnimatorSyncMaster.prototype={get currentTime(){return this._frame/DOW.CKK_STD_FPS},get currentPosition(){return this._frame/this.numberOfFrames},get playing(){return this._playing},get duration(){return this.numberOfFrames/DOW.CKK_STD_FPS},get numberOfFrames(){return this.sequences.reduce(function(e,t){return e<t.layer.length?t.layer.length:e},0)},get frame(){return Math.floor(this._frame)},set frame(e){e<0&&(e=0),e>=this.numberOfFrames&&(e=this.numberOfFrames-1),this._frame=e,this.seek(this._frame)},get speed(){return this._speed},set speed(e){this._speed=e},add_animator:function(e){this.sequences.push(e)},play:function(){this._playing=!0},pause:function(){this._playing=!1},seek:function(e){this._frame=e,this.sequences.forEach(function(t,n,i){t.seek(e)})},update:function(e){this._playing&&(this._frame+=e*this._speed*DOW.CKK_STD_FPS,this._frame>=this.numberOfFrames&&this._speed>0?(this._playing=!1,this._frame=this.numberOfFrames):this._frame<=0&&this._speed<0&&(this._playing=!1,this._frame=0),this.sequences.forEach(function(e,t,n){e.seek(this._frame)},this))}},function(){var e=function(e){this.name=e,this._enable=!0};e.prototype={constructor:e,get enable(){return this._enable},set enable(e){this._enable=e}};var t=function(t,n,i,o){e.call(this,t),this.resources=[],this.ignore_cache=o,this.done=!1,this.firstDone=!1,this.load_count=0,this.error_count=0,this.aborted=!1,this.alt_url=n,this.fixed_length=9999,this.resource_type="image"==i||"images"==i?-1!==n.indexOf(".ktx",n.length-4)?"texdata":"image":void 0,this._loader=this._create_image_loader()};t.prototype={constructor:t,load:function(e,t,n,i,o){var a=this._loader;i&&(a=i(a)),void 0==o&&(o=1);var r=this.ignore_cache?"?"+Date.now():"",s=this;console.log("load: "+this.alt_url);var l=/^(.*)\[(\d+)-(\d+)\](.*)$/.exec(this.alt_url);if(l){var c=l[1],h=+l[2]+0,_=+l[3]+1,u=l[4];this.fixed_length=Math.min(this.fixed_length,_-h);var d=function(i,s,l){if(!i.aborted){var h=i.load_index;i.load_index++;var _=c+h+u;h<i.fixed_length?a.load(_+r,function(a){if(!i.aborted){if(0==h&&(i.firstDone=!0),h<i.fixed_length){if(i.resources[h]=a,i.load_count++,d(i,s,l),0==h)for(;o-- >1;)d(i,e,n)}else i.done=!0;t&&t(i,(i.load_count+i.error_count)/fixed_length),s&&s(i,h,_)}},void 0,function(e){i.aborted||h>=i.fixed_length||(i.error_count++,l&&l(i,h,_,e))}):i.done=!0}};this.aborted=!1,this.load_index=0,d(this,e,n)}else this.resources[0]=a.load(this.alt_url+r,function(t){s.aborted||(s.resources[0]=t,s.load_count++,s.firstDone=!0,s.done=!0,e(s,0,s.alt_url))},void 0,function(e){s.aborted||(s.error_count++,n&&n(s,0,s.alt_url,e))})},get length(){return this.resources.length},fix_length:function(e){this.fixed_length=e,this.length<e||(this.length>e?(this.resources.splice(e),this.done=!0):this.done=!0)},abort_loading:function(){this.aborted=!0},_create_image_loader:function(){if(-1!==this.alt_url.indexOf(".ktx",this.alt_url.length-4))return new DOW.KTXLoaderWithoutTexture;var e=new THREE.ImageLoader;return e.setCrossOrigin("use-credentials"),e}},Object.setPrototypeOf(t.prototype,e.prototype),DOW.Layer=e,DOW.TextureLayer=t}(),DOW.Trackball=function(e){this.type="Tracker",this.app=e,this.element=e.gui.domElement,this.deltaRotation=new THREE.Quaternion,this._inertia=0,this._center=new THREE.Vector2,this._radius=1;var t=this,n=new THREE.Vector3,i=new THREE.Vector3,o=new THREE.Vector3,a=new THREE.Vector2,r=new THREE.Quaternion(0,0,0,1);function s(e,n,i,o){var a=1/t.element.clientHeight,r=DOW.WTOP*(2*e-t.element.clientWidth)*a,s=DOW.WTOP*(1-2*n*a),l=(e=(r-o.x)/t._radius)*e+(n=(s-o.y)/t._radius)*n,c=Math.sqrt(l);return l>1?i.set(e/c,n/c,0):i.set(e,n,Math.sqrt(1-l)),c}var l=!1;try{var c=Object.defineProperty({},"passive",{get:function(){l=!0}});window.addEventListener("testPassive",null,c),window.removeEventListener("testPassive",null,c)}catch(e){}function h(e){e.preventDefault(),e.stopPropagation(),t.track(e.clientX,e.clientY)}function _(e){e.preventDefault(),e.stopPropagation(),t.track_end(),t.element.removeEventListener("mousemove",h),t.element.removeEventListener("mouseup",_)}this.reset=function(){this.deltaRotation.set(0,0,0,1),this._tracking=!1},this.update=function(e){return this._tracking?this._inertia>0&&e<this._inertia?(o.copy(n).lerp(i,e/this._inertia),this.deltaRotation.setFromUnitVectors(n,o),n.copy(o)):(this.deltaRotation.setFromUnitVectors(n,i),n.copy(i)):2*Math.acos(this.deltaRotation.w)>1e-7?this.deltaRotation.slerp(r,e*(1-this._inertia)):this.deltaRotation.set(0,0,0,1),!this.deltaRotation.equals(r)},this.start_track=function(e,o){return function(e,n,i){var o=1/t.element.clientHeight;i.x=DOW.WTOP*(2*e-t.element.clientWidth)*o,i.y=DOW.WTOP*(1-2*n*o)}(e,o,a),!(s(e,o,i,DOW.CKK_ROTATION_POLICY?a:t._center)>1.1)&&(n.copy(i),t.deltaRotation.set(0,0,0,1),t._tracking=!0,!0)},this.track=function(e,n){s(e,n,i,DOW.CKK_ROTATION_POLICY?a:t._center)},this.track_end=function(e,n){t._tracking=!1};var u=-1;function d(e){e.preventDefault(),e.stopPropagation();var n=void 0;for(var i in e.changedTouches)if(e.changedTouches[i].identifier==u){n=e.changedTouches[i];break}void 0!=n&&t.track(n.clientX,n.clientY)}function m(e){e.preventDefault(),e.stopPropagation(),u=-1,t.track_end(),t.element.removeEventListener("touchmove",d),t.element.removeEventListener("touchend",m),t.element.removeEventListener("touchcancel",m)}this.element.addEventListener("mousedown",function(e){t.start_track(e.clientX,e.clientY)&&(e.preventDefault(),e.stopPropagation(),t.element.addEventListener("mousemove",h,!1),t.element.addEventListener("mouseup",_,!1))},!1),this.element.addEventListener("touchstart",function(e){var n=e.targetTouches[0];u<0&&e.target==t.element&&t.start_track(n.clientX,n.clientY)&&(e.preventDefault(),e.stopPropagation(),u=n.identifier,t.element.addEventListener("touchmove",d,!!l&&{passive:!1}),t.element.addEventListener("touchend",m,!1),t.element.addEventListener("touchcancel",m,!1))},!!l&&{passive:!1})},DOW.Trackball.prototype={set center(e){this._center.set(e[0],e[1])},get radius(){return this._radius},set radius(e){this._radius=e},get inertia(){return this._inertia},set inertia(e){e<0&&(e=0),e>1&&(e=1),this._inertia=e}},DOW.GUI=function(e){for(var t in this.type="GUI",this._app=e,this.buttons={},this.buttons_by_config_name={},this._visible=!0,this.domElement=document.createElement("div"),this.domElement.id="dow_ui",this.domElement.style.position="absolute",this.domElement.style.top=0,this.domElement.style.left=0,this.domElement.style.margin=0,this.domElement.style.width="100%",this.domElement.style.height="100%",DOW.ICONS){var n=this.create_button(e.icondir,DOW.ICONS[t]);this.buttons[n.button_name]=n,this.buttons_by_config_name[n.config_name]=n}},DOW.GUI.prototype={layout:function(e){for(var t in DOW.ICONS){var n=DOW.ICONS[t][0];(r=this.buttons_by_config_name[n]).conf=e.config[n],void 0===r.conf||0==r.conf[0]||e.config.Icon<=t?(r.conf=[0,0,0],r.style.display="none"):r.style.display=""}2!=e.config.NumberOfTextures&&(this.buttons.layer.style.display="none"),this.buttons.screen_small.style.display="none",this.buttons.screen_large.style.display="none",this.buttons.screen_left.style.display="none",this.buttons.screen_right.style.display="none",this.buttons.screen_down.style.display="none",this.buttons.screen_up.style.display="none",this.buttons.draring_pen.style.display="none",this.buttons.drawing_erase.style.display="none",this.buttons.drawing_save.style.display="none";var i=this.domElement.clientHeight/4,o=this.domElement.clientWidth/2;for(var a in this.buttons_by_config_name){var r,s=(r=this.buttons_by_config_name[a]).conf[1]*i+o,l=(DOW.WTOP-r.conf[2])*i;r.style.position="absolute",r.style.top=l+"px",r.style.left=s+"px";var c=r.conf[0]*i+"px";r.style.width=c,r.style.height=c}},show:function(){this.layout(this._app)},hide:function(){for(var e in this.buttons_by_config_name)this.buttons_by_config_name[e].style.display="none"},hide_except_icon23:function(){for(var e in this.buttons_by_config_name)"Icon23ScaleXY"!=e&&(this.buttons_by_config_name[e].style.display="none")},_call_command:function(e){if(e)for(var t=e.split(","),n=0;n<t.length;n++)this._app["command_"+t[n].trim()]()},create_button:function(e,t){var n=document.createElement("img");n.className="dow_button",n.style.display="none",n.alt=DOW.BUTTON_ALT_TEXT[t[0]],n.setAttribute("role","button"),n.config_name=t[0],n.button_name=t[1],n.command=t[2],n.icon1=this.path2url(e,t[3]),n.icon2=t.length>4?this.path2url(e,t[4]):void 0,n.conf=[0,0,0],this.domElement.appendChild(n),n.src=n.icon1;var i=this;return n.onclick=function(){this.command&&i._call_command(this.command)},n},path2url:function(e,t){return 0===t.lastIndexOf("data:",0)||0===t.lastIndexOf("file://",0)||0===t.lastIndexOf("http:",0)||0===t.lastIndexOf("https://",0)?t:e+"/"+t}},DOW.Earth=function(e){this.type="Earth",this.layers=e,e.forEach(function(e){e.texture.minFilter=THREE.LinearFilter,e.texture.generateMipmaps=!1}),this.material=new THREE.MeshBasicMaterial({map:e[0].texture});this.grid_uniforms={line_width:{value:.4},equater_width:{value:.6},line_color:{value:[.9,.9,.9,.4]},equater_color:{value:[.8,.2,.2,.5]},num_lon:{value:12},num_lat:{value:6}},this.grid_material=new THREE.ShaderMaterial({vertexShader:"varying vec2 vUv;  \nvoid main() {  \n  vUv = uv;  \n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);  \n} ",fragmentShader:"varying vec2 vUv;  \nuniform float line_width;  \nuniform float equater_width;  \nuniform vec4 line_color;  \nuniform vec4 equater_color;  \nuniform float num_lon;  \nuniform float num_lat;  \nfloat s(in float u, in float w, const in float n) {  \n  u *= n;  \n  w *= n * 0.25;  // 線の幅を度にするために 90(=absの振幅)/360 をかける  \n  return smoothstep(-(1.0+0.2)*w, -(1.0-0.2)*w, - abs((u-0.5 - floor(u-0.5)) - 0.5) * 90.0);  \n}  \nvoid main() {  \n  float equ_w = equater_width;  \n  float lat_w = line_width;  \n  float lon_w = line_width * 0.5 / cos(radians((vUv.y - 0.5) * 180.0));  \n  float equ_a = s(vUv.y-0.5, equ_w, 1.0);  \n  float lin_a = max(0.0, min(1.0, s(vUv.x, lon_w, num_lon) + s(vUv.y, lat_w, num_lat)) - equ_a);  \n  gl_FragColor = equater_color * equ_a + line_color * lin_a;  \n} ",uniforms:this.grid_uniforms,transparent:!0,depthTest:!1}),this.obj3d=this.setup_obj3d()},DOW.Earth.prototype={get scale(){return this.obj3d.scale.x},set scale(e){this.obj3d.scale.set(e,e,e)},get position(){return[this.obj3d.position.x,this.obj3d.position.y]},set position(e){this.obj3d.position.set(e[0],e[1],0)},get rotation(){return this.obj3d.rotation},set rotation(e){this.obj3d.rotation.copy(e)},get showGrid(){return this._grid.visible},set showGrid(e){return this._grid.visible=e},setFrontLonLat:function(e,t){var n=Math.PI/180;this.obj3d.rotation.set(t*n,-(e+90)*n,0,"XYZ")},setGridParam:function(e){this.grid_uniforms.line_width.value=e.line[0]?0:.15*e.line[3],this.grid_uniforms.equater_width.value=e.line[0]?0:.15*e.line[4],this.grid_uniforms.line_color.value=e.color.slice(0,4),this.grid_uniforms.equater_color.value=e.color.slice(4,8),this.grid_uniforms.num_lon.value=e.line[1],this.grid_uniforms.num_lat.value=e.line[2]},localRotate:function(e){this.obj3d.quaternion.multiply(e)},rotate:function(e){this.obj3d.quaternion.multiplyQuaternions(e,this.obj3d.quaternion)},northUp:function(){},changeLayer:function(e){e<this.layers.length&&this.layers.forEach(function(t,n){t.enable=n==e})},setup_obj3d:function(){var e=new THREE.SphereGeometry(1,64,64);this._map=new THREE.Mesh(e,this.material),this._grid=new THREE.Mesh(e,this.grid_material);var t=new THREE.Group;return t.add(this._map),t.add(this._grid),t}},DOW.Screen=function(e){this.type="Screen",this.layers=e,this.aspect=e[0].aspect||1;this.material=new THREE.ShaderMaterial({uniforms:{map:{value:e[0].texture}},vertexShader:"varying vec2 vUv; \nvoid main() { \n  vUv = uv;  \n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0); \n}",fragmentShader:"varying vec2 vUv; \nuniform sampler2D map; \nvoid main() { \n  vec4 color = texture2D(map, vUv); \n  // 背景の黒部分を滑らかに透過させる  \n  color.a = smoothstep(0.0, 0.2, 0.299 * color.r + 0.587 * color.g + 0.114 * color.b);  \n  gl_FragColor = color;  \n}",transparent:!0,depthTest:!1}),this.mesh=this.setup_mesh(this.material),this.top_left=[0,0]},DOW.Screen.prototype={get scale(){return this.mesh.scale.x},set scale(e){var t=.5*e,n=t*this.aspect;this.mesh.scale.set(e,e,e),this.mesh.position.set(this.top_left[0]+n,this.top_left[1]-t,0)},get position(){return this.top_left},set position(e){var t=.5*this.mesh.scale.y,n=t*this.aspect;this.mesh.position.set(e[0]+n,e[1]-t,0),this.top_left=e},get visible(){return this.mesh.visible},set visible(e){this.mesh.visible=e},get forceFront(){return!this.material.depthTest},set forceFront(e){this.material.depthTest=!e},changeLayer:function(e){e<this.layers.length&&this.layers.forEach(function(t,n){t.enable=n==e})},setup_mesh:function(e){return new THREE.Mesh(new THREE.PlaneBufferGeometry(this.aspect,1,1,1),e)}},DOW.Application=function(e,t){var n;console.log("DagikEarth on the Web (version "+DOW.VERSION+")"),this.type="Application",DOW.plugins.register(t),this.content_base=t.hasOwnProperty("content_base")?t.content_base+"/":"",this.configs=t.hasOwnProperty("configs")?t.configs:["data/conf/init_conf.txt","data/conf/conf.txt","data/conf/dow_conf.txt"],this.icondir=t.hasOwnProperty("icondir")?t.icondir:"data/js/icons",this.frame_update_hook=t.hasOwnProperty("frame_update_hook")?t.frame_update_hook:void 0,this.load_completed_hook=t.hasOwnProperty("load_completed_hook")?t.load_completed_hook:void 0,this.fast_view=!t.hasOwnProperty("fast_view")||t.fast_view,this.console=t.hasOwnProperty("console")?t.console:void 0,this.image_loader_wrapper_function=t.hasOwnProperty("image_loader_wrapper")?t.image_loader_wrapper:function(e){return e},this.config_loader_wrapper_function=t.hasOwnProperty("config_loader_wrapper")?t.config_loader_wrapper:void 0,this.northup_method=t.hasOwnProperty("northup_method")?t.northup_method:"hybrid",DOW.plugins.init(t,this),this.domElement=document.getElementById(e),this.domElement.className="dow_main",this.domElement.style.position="relative",this.renderer,this.scene,this.camera,this.earth1,this.screen1,this.gui,this.trackball,this._current_layer=0,this._show_screen=!0,this._spin_status=!1,this._animation_status=0,this._animation_speed=8,this._show_grid=!1,this._earth_scale=1,this._show_icons=!0,this._manual_rotation=null,this.flag_cancel_loading=!1,this.config=new DOW.Config(this);try{var i=document.createElement("canvas");n=!(!window.WebGLRenderingContext||!i.getContext("webgl")&&!i.getContext("experimental-webgl"))}catch(e){n=!1}if(n&&(this.renderer=new THREE.WebGLRenderer,this.domElement.appendChild(this.renderer.domElement),this.renderer.setSize(this.domElement.clientWidth,this.domElement.clientHeight),this.renderer.setClearColor(new THREE.Color(0,0,0),1),DOW.log("PixelRatio: default="+this.renderer.getPixelRatio()+" device="+window.devicePixelRatio),this.renderer.setPixelRatio(window.devicePixelRatio),DOW.CompressedTextureUtil.checkExtensions(this.renderer),DOW.plugins.invoke("on_gl_ready",this)),this.gui=new DOW.GUI(this),this.domElement.appendChild(this.gui.domElement),this.console||(this.console=new DOW.Console(this,this.domElement),this.domElement.appendChild(this.console.domElement)),this.console.clear(),n){THREE.Cache.enabled=!1;var o=this;document.addEventListener("keydown",function(e){o.renderer&&o.flag_scene_prepared&&o.key_event(e)}),document.addEventListener("keypress",function(e){o.renderer&&o.flag_scene_prepared&&o.key_event(e)});var a=0;window.addEventListener("resize",function(e){o.renderer&&o.gui&&(++a,window.setTimeout(function(){--a>0||(o.layout(),o.gui.layout(o))},250))}),this.frame_updater=void 0}else this.console.addDetail("E0001","")},DOW.Application.prototype={Run:function(e){if(this.renderer){this.Stop(),void 0!==e&&(e.hasOwnProperty("content_base")&&(this.content_base=e.content_base+"/"),e.hasOwnProperty("configs")&&(this.configs=e.configs),e.hasOwnProperty("icondir")&&(this.icondir=e.icondir),e.hasOwnProperty("fast_view")&&(this.fast_view=e.fast_view),e.hasOwnProperty("frame_update_hook")&&(this.frame_update_hook=e.frame_update_hook),e.hasOwnProperty("load_completed_hook")&&(this.load_completed_hook=e.load_completed_hook),e.hasOwnProperty("image_loader_wrapper")&&(this.image_loader_wrapper_function=e.image_loader_wrapper),e.hasOwnProperty("config_loader_wrapper")&&(this.config_loader_wrapper_function=e.config_loader_wrapper),e.hasOwnProperty("northup_method")&&(this.northup_method=e.northup_method)),DOW.plugins.run(e,this),this.flag_cancel_loading=!0,this.next_reload_time=void 0,this.console.clear(),this.console.showProgress(0,0,0,DOW.MESSAGES.M0001),DOW.plugins.invoke("on_pre_config",this);var t=this;this.flag_cancel_loading=!1,this.config.set_loader_wrapper(this.config_loader_wrapper_function),this.config.load(this.configs.map(function(e){return t.get_absolute_path(e)}),function(){DOW.plugins.invoke("on_post_config",t),t.setup_resources()},!0),this.frame_updater=this.start_frame_loop()}},Stop:function(){if(this.frame_updater){if(DOW.plugins.invoke("on_pre_stop",this),this.flag_cancel_loading=!0,this.layers)for(var e in this.layers)this.layers[e].abort_loading();this.frame_updater.loop=!1,this.frame_updater=void 0,DOW.plugins.invoke("on_post_stop",this)}this.flag_scene_prepared=!1},get current_layer(){return this._current_layer},set current_layer(e){this._current_layer=e,this.earth1&&this.earth1.changeLayer(e),this.screen1&&this.screen1.changeLayer(e);var t=this.gui.buttons.layer;t&&(t.src=0==e?t.icon1:t.icon2)},get show_screen(){return this._show_screen},set show_screen(e){this._show_screen=e,this.screen1&&(this.screen1.visible=e);var t=this.gui.buttons.show_screen;t&&(t.src=e?t.icon1:t.icon2)},get show_grid(){return this._show_grid},set show_grid(e){this._show_grid=e,this.earth1&&(this.earth1.showGrid=e);var t=this.gui.buttons.show_grid;t&&(t.src=e?t.icon2:t.icon1)},get spin_status(){return this._spin_status},set spin_status(e){this._spin_status=e;var t=this.gui.buttons.auto_spin;t&&(t.src=e?t.icon2:t.icon1)},get animation_status(){return this._animation_status},set animation_status(e){if(this._animation_status=e,0==e)this.animationController.pause();else{var t=this.speedFromCKK(this.animation_speed)*this.animation_status;this.animationController.speed=t,this.animationController.play()}var n=this.gui.buttons.forward_play;n&&(n.src=1!=e?n.icon1:n.icon2),(n=this.gui.buttons.reverse_play)&&(n.src=-1!=e?n.icon1:n.icon2)},get animation_speed(){return this._animation_speed},set animation_speed(e){this._animation_speed=e>32?32:e<1?1:e;var t=this.speedFromCKK(this.animation_speed)*this.animation_status;this.animationController.speed=t},get earth_scale(){return this._earth_scale},set earth_scale(e){this._earth_scale=e,this.earth1&&(this.earth1.scale=this.config.Scale*this._earth_scale),this.trackball&&(this.trackball.radius=this.earth1.scale)},get show_icons(){return this._show_icons},set show_icons(e){this._show_icons=e,e?this.gui.show():this.gui.hide_except_icon23()},setup_resources:function(){if(document.title=this.config.WindowTitle,console.log("TextureEnd: "+this.config.TextureEnd),""!=this.config.AltTextureName[0]&&"images"==this.config.AltTextureName[1]){var e=this.config.AltTextureName[0].match(/\[(\d+)-(\d+)\]/);3==e.length&&(this.config.TextureStart=parseInt(e[1]),this.config.TextureEnd=parseInt(e[2])+1)}var t="["+this.config.TextureStart+"-"+(this.config.TextureEnd-1)+"]";""==this.config.AltTextureName[0]&&(console.log("alt texture name: "+this.config.AltTextureName[0]),this.config.AltTextureName=[this.config.TextureName+t+"."+this.config.TextureSuffix,"images"]),""==this.config.AltSecondTextureName[0]&&(this.config.AltSecondTextureName=[this.config.SecondTextureName+t+"."+this.config.SecondTextureSuffix,"images"]),""==this.config.AltTextureName2[0]&&(this.config.AltTextureName2=[this.config.TextureName2+t+"."+this.config.TextureSuffix2,"images"]),""==this.config.AltSecondTextureName2[0]&&(this.config.AltSecondTextureName2=[this.config.SecondTextureName2+t+"."+this.config.SecondTextureSuffix2,"images"]),""==this.config.AltScreenName[0]&&(this.config.AltScreenName=[this.config.ScreenName+t+"."+this.config.ScreenSuffix,"images"]),""==this.config.AltSecondScreenName[0]&&(this.config.AltSecondScreenName=[this.config.SecondScreenName+t+"."+this.config.SecondScreenSuffix,"images"]),""==this.config.AltScreenName2[0]&&(this.config.AltScreenName2=[this.config.ScreenName2+t+"."+this.config.ScreenSuffix2,"images"]),""==this.config.AltSecondScreenName2[0]&&(this.config.AltSecondScreenName2=[this.config.SecondScreenName2+t+"."+this.config.SecondScreenSuffix2,"images"]);var n=[];n.push(this.texture_layer("earth1_layer1_map",this.config.AltTextureName)),n.push(this.texture_layer("earth1_layer1_screen",this.config.AltScreenName)),2==this.config.NumberOfTextures&&(n.push(this.texture_layer("earth1_layer2_map",this.config.AltSecondTextureName)),n.push(this.texture_layer("earth1_layer2_screen",this.config.AltSecondScreenName))),this.layers=n.reduce(function(e,t){return e[t.name]=t,e},{}),this.load_resources()},load_resources:function(e){if(!this.flag_cancel_loading){DOW.plugins.invoke("on_pre_load",this);var t=[];for(var n in this.layers)t.push(this.layers[n]);var i=this;this.console.showProgress(0,0,0,DOW.MESSAGES.M0002);var o=!1,a=this.config.TextureEnd-this.config.TextureStart,r=function(e,t,n){return e.done||!e.enable},s=function(e,t,n){return e.firstDone||!e.enable},l=function(e,t,n,i){return t.enable&&(e[0]+=t.load_count,e[1]+=t.error_count,e[2]+=t.fixed_length),e},c=function(e,n,o){var a=t.reduce(l,[0,0,0]),r=a[2]>=9999?"---":a[2];i.console.showProgress(a[0]/a[2],a[0],r,DOW.MESSAGES.M0002),_()},h=function(n,o,r){e?(n.abort_loading(),i.console.addDetail("E0101",r),i.console.addDetail("I0103","("+i.config.AutoReloadIntervalMin+"分後)"),i.console.showError(DOW.MESSAGES.M1002)):(0==o?("earth1_layer1_map"==n.name||"earth1_layer1_screen"==n.name?i.console.addDetail("W0101",r):i.console.addDetail("I0101",r),n.enable=!1,n.abort_loading()):o<a&&(a=o,t.forEach(function(e){e.fix_length(o)})),_())};t.forEach(function(e){e.enable&&e.load(c,void 0,h,i.image_loader_wrapper_function,2)})}function _(){var n=i.layers.earth1_layer1_map&&i.layers.earth1_layer1_map.enable||i.layers.earth1_layer1_screen&&i.layers.earth1_layer1_screen.enable;!i.flag_scene_prepared&&(i.fast_view&&t.every(s)||t.every(r))&&(n?i.setup_scene():i.console.showError(DOW.MESSAGES.M1001)),n&&t.every(r)&&(i.flag_scene_prepared&&i.console.clear(),o||(o=!0,DOW.plugins.invoke("on_post_load",this),i.load_completed_hook&&i.load_completed_hook(),e&&console.log("reloaded")))}},texture_layer:function(e,t){var n=t[0],i=t[1],o="image"==i;return new DOW.TextureLayer(e,this.get_absolute_path(n),i,o)},get_absolute_path:function(e){return 0===e.lastIndexOf("http://",0)||0===e.lastIndexOf("https://",0)||0===e.lastIndexOf("file://",0)?e:this.content_base+e},setup_scene:function(){DOW.plugins.invoke("on_pre_scene",this);var e=this.domElement.clientWidth/this.domElement.clientHeight;if(this.config.Perspective){var t=2*Math.atan(DOW.WTOP/this.config.EyePosition)*180/Math.PI;this.camera=new THREE.PerspectiveCamera(t,e,.01,1e3)}else this.camera=new THREE.OrthographicCamera(-DOW.WTOP*e,DOW.WTOP*e,DOW.WTOP,-DOW.WTOP,.01,1e3);if(this.camera.position.z=this.config.EyePosition,this.camera.lookAt(new THREE.Vector3(0,0,0)),this.animationController=new DOW.AnimationController,this.animationController.loop=this.config.Repeat,this.animationController.firstFramePause=this.config.StopAt1stMap,this.animationController.lastFramePause=this.config.StopAtFinalMap,this.layers.earth1_layer1_map&&this.layers.earth1_layer1_map.enable){var n=[new DOW.TextureAnimator(this.layers.earth1_layer1_map)];this.layers.earth1_layer2_map&&this.layers.earth1_layer2_map.enable&&n.push(new DOW.TextureAnimator(this.layers.earth1_layer2_map)),this.animationController.add(n);var i=new DOW.Earth(n);n.forEach(function(e){e.setTargetMaterial(i.material)}),this.earth1=i}if(this.layers.earth1_layer1_screen&&this.layers.earth1_layer1_screen.enable){n=[new DOW.TextureAnimator(this.layers.earth1_layer1_screen)],this.layers.earth1_layer2_screen&&this.layers.earth1_layer2_screen.enable&&n.push(new DOW.TextureAnimator(this.layers.earth1_layer2_screen)),this.animationController.add(n);var o=new DOW.Screen(n);n.forEach(function(e){e.setTargetMaterial(o.material)}),o.scale=this.config.ScreenScaleXY[0],o.position=[this.config.ScreenScaleXY[1],this.config.ScreenScaleXY[2]],o.visible=this.config.ScreenOn,o.forceFront=this.config.ScreenFront,this.screen1=o}this.earth1&&this.earth1.setGridParam({line:this.config.MeridianLatitude,color:this.config.ColorMeridianLatitude}),this.show_grid=this.config.MeridianLatitude[0],this.scene=new THREE.Scene,this.earth1&&this.scene.add(this.earth1.obj3d),this.screen1&&this.scene.add(this.screen1.mesh),this.scene.add(new THREE.AmbientLight(16777215)),this.layout(),this.show_icons=!0,this.gui.layout(this),this.command_initialize(),this.earth1&&(this.trackball=new DOW.Trackball(this),this.trackball.inertia=.2,this.trackball.radius=this.earth1.scale,this.trackball.center=this.earth1.position),DOW.plugins.invoke("on_post_scene",this),this.flag_scene_prepared=!0},start_frame_loop:function(){var e={loop:!0},t=.001*Date.now(),n=new THREE.Quaternion,i=this,o=function(){var a=.001*Date.now()-t;t+=a,i.flag_scene_prepared&&(DOW.plugins.invoke("on_pre_frame",i),function(e){i.frame_update_hook&&i.frame_update_hook();var t=null;if(null!=i._manual_rotation?2*Math.acos(i._manual_rotation.w)>.01?((t=new THREE.Quaternion(w=0).slerp(i._manual_rotation,5*e)).inverse(),i._manual_rotation.multiply(t),t.inverse()):i._manual_rotation=null:i.trackball&&!i.config.NoMouseDragRotation&&i.trackball.update(e)&&(t=i.trackball.deltaRotation),null!=t&&void 0!==i.earth1&&i.earth1.rotate(t),i.spin_status){var o=.003*i.spin_speed*(e/i.config.SpinIntervalSecond);n.setFromAxisAngle(new THREE.Vector3(0,1,0),o*Math.PI/180),void 0!==i.earth1&&i.earth1.localRotate(n)}i.animationController.update(e),0!=i.animation_status&&0==i.animationController.status&&(i.animation_status=0)}(a),DOW.plugins.invoke("on_post_frame",i),i.config.AutoReload&&!i.next_reload_time?i.next_reload_time=Date.now()+60*i.config.AutoReloadIntervalMin*1e3:i.next_reload_time&&i.next_reload_time<Date.now()&&(i.next_reload_time=Date.now()+60*i.config.AutoReloadIntervalMin*1e3,i.load_resources(!0))),e.loop&&requestAnimationFrame(o),i.flag_scene_prepared?(DOW.plugins.invoke("on_pre_render",i),i.renderer.render(i.scene,i.camera),DOW.plugins.invoke("on_post_render",i)):i.renderer.clear(!0,!0,!0)};return o(),e},layout:function(){var e=this.domElement.clientWidth,t=this.domElement.clientHeight;if(this.renderer.setSize(e,t),DOW.log("layout.setSize("+e+", "+t+")"),this.camera){var n=e/t;this.config.Perspective?this.camera.aspect=n:(this.camera.right=DOW.WTOP*n,this.camera.left=-DOW.WTOP*n),this.camera.updateProjectionMatrix()}},key_event:function(e){var t;if("keydown"==e.type)switch(e.keyCode){case 13:t="ENTER";break;case 27:t="ESCAPE";break;case 37:t="LEFT_ARROW";break;case 38:t="UP_ARROW";break;case 39:t="RIGHT_ARROW";break;case 40:t="DOWN_ARROW"}else"keypress"==e.type&&(t=String.fromCharCode(e.charCode));if(void 0!==t){var n=DOW.KEY_ACTION[t];if(void 0!==n)for(var i=n.split(","),o=0;o<i.length;o++)this["command_"+i[o].trim()]()}},command_initialize:function(){DOW.log("command_initialize"),this.command_initialize_view(),this.command_initialize_control(),this.animationController.seek(0),this.animation_status=this.config.Animation,this.animation_speed=this.config.AnimationSpeed},command_initialize_view:function(){if(DOW.log("command_initialize_view"),this.earth_scale=1,this.earth1){var e=this.earth1.scale;this.earth1.position=DOW.CKK_EARTHXY_POLICY?[this.config.EarthXY[0]*e,this.config.EarthXY[1]*e]:this.config.EarthXY,this.earth1.setFrontLonLat(this.config.Longitude,this.config.Latitude)}this.trackball&&this.trackball.reset()},command_initialize_control:function(){DOW.log("command_initialize_control"),this.spin_status=this.config.Spin,this.spin_speed=this.config.SpinSpeed,this.current_layer=this.config.SecondTexture_at_startup&&2==this.config.NumberOfTextures?1:0,this.show_grid=this.config.MeridianLatitude[0],this.show_screen=this.config.ScreenOn},command_fullscreen:function(){var e;if(DOW.log("command_fullscreen"),void 0!==document.fullscreenElement)e=document.fullscreenElement;else if(void 0!==document.webkitFullscreenElement)e=document.webkitFullscreenElement;else if(void 0!==document.mozFullScreenElement)e=document.mozFullScreenElement;else{if(void 0===document.msFullscreenElement)return;e=document.msFullscreenElement}null==e?this.domElement.requestFullscreen?this.domElement.requestFullscreen():void 0!==this.domElement.webkitRequestFullscreen?this.domElement.webkitRequestFullscreen():this.domElement.mozRequestFullScreen?this.domElement.mozRequestFullScreen():this.domElement.msRequestFullscreen&&this.domElement.msRequestFullscreen():document.exitFullscreen?document.exitFullscreen():document.cancelFullScreen?document.cancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()},command_fullscreen_off:function(){DOW.log("command_fullscreen_off"),document.exitFullscreen?document.exitFullscreen():document.cancelFullScreen?document.cancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()},command_hide_all_icons:function(){DOW.log("command_hide_all_icons"),this.show_icons=!this.show_icons},command_quit:function(){DOW.log("command_quit"),window.history.back()},command_show_grid:function(){this.show_grid=!this.show_grid,DOW.log("command_show_grid")},command_show_screen:function(){this.show_screen=!this.show_screen,DOW.log("command_show_screen")},command_reset_north:function(){if(DOW.log("command_reset_north"),this.trackball&&this.earth1){this.trackball&&this.trackball.reset();var e=new THREE.Vector3(0,1,0).applyQuaternion(this.earth1.obj3d.quaternion),t=this.northup_method;if("hybrid"==t&&(t=this.earth_scale>1?"rotate":"move+up"),-1!==t.indexOf("+up",t.length-3)&&e.x>-.01&&e.x<.01&&e.y>.01)this._manual_rotation=(new THREE.Quaternion).setFromUnitVectors(e,new THREE.Vector3(0,1,0));else{var n=(new THREE.Vector3).copy(e);switch(t){case"rotate":case"rotate+up":case"rotate&up":n.z=0,n.normalize(),this._manual_rotation=(new THREE.Quaternion).setFromUnitVectors(n,new THREE.Vector3(0,1,0));break;case"move":case"move+up":case"move&up":n.x=0,n.y=Math.sqrt(1-n.z*n.z),this._manual_rotation=(new THREE.Quaternion).setFromUnitVectors(e,n)}-1!==t.indexOf("&up",t.length-3)&&(e.applyQuaternion(this._manual_rotation),this._manual_rotation.premultiply((new THREE.Quaternion).setFromUnitVectors(e,new THREE.Vector3(0,1,0))))}}},command_layer:function(){2==this.config.NumberOfTextures&&(this.current_layer=0==this.current_layer?1:0),DOW.log("command_layer")},command_forward_play:function(){DOW.log("command_forward_play"),this.animation_status=1==this.animation_status?0:1},command_reverse_play:function(){DOW.log("command_reverse_play"),this.animation_status=-1==this.animation_status?0:-1},command_pause_or_play:function(){DOW.log("command_pause_or_play"),this.animation_status=0==this.animation_status?1:0},command_first_frame:function(){this.animationController.seek(0),DOW.log("command_first_frame")},command_last_frame:function(){this.animationController.seek(this.animationController.numberOfFrames-1),DOW.log("command_last_frame")},command_play_fast:function(){this.animation_speed++,DOW.log("command_play_fast")},command_play_slow:function(){this.animation_speed--,DOW.log("command_play_slow")},speedFromCKK:function(e){return Math.pow(2,e/2-4)},command_step_backward:function(){this.animation_status=0,this.animationController.step(-1),DOW.log("command_step_backward")},command_step_backward_or_wrap:function(){this.animation_status=0,0==this.animationController.frame?this.command_last_frame():this.animationController.step(-1),DOW.log("command_step_backward_or_warp")},command_step_backward10:function(){this.animation_status=0,this.animationController.step(-10),DOW.log("command_step_backward10")},command_step_forward:function(){this.animation_status=0,this.animationController.step(1),DOW.log("command_step_forward")},command_step_forward_or_wrap:function(){this.animation_status=0,this.animationController.frame==this.animationController.numberOfFrames-1?this.command_first_frame():this.animationController.step(1),DOW.log("command_step_forward_or_wrap")},command_step_forward10:function(){this.animation_status=0,this.animationController.step(10),DOW.log("command_step_forward10")},command_auto_spin:function(){this.spin_status=!this.spin_status,DOW.log("command_auto_spin")},command_spin_fast:function(){this.spin_speed+=1,DOW.log("command_spin_fast")},command_spin_slow:function(){this.spin_speed-=1,DOW.log("command_spin_slow")},command_zoom_in:function(){this.earth_scale*=1.1,DOW.log("command_zoom_in")},command_zoom_in_petit:function(){this.earth_scale*=1.01,DOW.log("command_zoom_in_petit")},command_zoom_out:function(){this.earth_scale/=1.1,DOW.log("command_zoom_out")},command_zoom_out_petit:function(){this.earth_scale/=1.01,DOW.log("command_zoom_out_petit")},command_screen_down:function(){DOW.log("command_screen_down")},command_screen_large:function(){DOW.log("command_screen_large")},command_screen_left:function(){DOW.log("command_screen_left")},command_screen_right:function(){DOW.log("command_screen_right")},command_screen_small:function(){DOW.log("command_screen_small")},command_screen_up:function(){DOW.log("command_screen_up")},command_rotate_x_plus:function(){this._manual_rotation=(new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(0,1,0),.05)},command_rotate_x_minus:function(){this._manual_rotation=(new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(0,1,0),-.05)},command_rotate_y_plus:function(){this._manual_rotation=(new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(1,0,0),-.05)},command_rotate_y_minus:function(){this._manual_rotation=(new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(1,0,0),.05)},command_drawing_pen:function(){},command_drawing_erase:function(){},command_drawing_undo:function(){},command_drawing_save:function(){},command_forward_changelayer:function(){this.command_step_forward_or_wrap(),this.command_layer(),DOW.log("command_forward_changelayer")},command_up_arrow_key:function(){this.command_rotate_y_plus()},command_down_arrow_key:function(){this.command_rotate_y_minus()},command_right_arrow_key:function(){this.config.PresentationRemoteMode||this.config.PresentaionRemoteMode?this.command_step_forward():this.command_rotate_x_plus()},command_left_arrow_key:function(){this.config.PresentationRemoteMode||this.config.PresentaionRemoteMode?this.command_step_backward():this.command_rotate_x_minus()},command_force_reload:function(){console.log("reload"),this.load_resources(!0)},command_toggle_console:function(){this.console.toggle()},command_loading_console:function(){this.console.loading()}};